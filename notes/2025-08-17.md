2025-08-17 – Auth, PDF extraction, and UX updates

Summary of changes

- PDF extraction
  - Added pypdfium2 and implemented robust rendering in `app/gen/vision_extractor.py`.
  - Introduced batching, parallel execution, and per-call timeouts for Vision (Anthropic/OpenAI) with cross-provider fallback and `pdfplumber` fallback.
  - Added detailed error surfacing to UI (render errors, API key issues, empty content diagnostics).
  - Implemented EasyOCR-based extractor (`app/gen/easyocr_extractor.py`) and made it the default path for PDFs (configurable via `PDF_EXTRACTOR`).
  - Added config knobs in `app/config.py`: `PDF_VISION_*`, `PDF_OCR_*`, `EASYOCR_LANGS`.

- Auth and registration
  - Implemented LinkedIn OAuth using OpenID Connect (`/login/linkedin` and callback), with state protection and userinfo endpoint; falls back to classic email endpoint if needed.
  - Fixed legacy route alias `/oauth/linkedin/start` → `/login/linkedin`.
  - Registration form now includes Confirm Password and two checkboxes (Privacy Policy required, Marketing opt-in optional) with dark theme custom checkboxes.
  - Added policy pages: `/privacy` and `/email-policy`.
  - Persisted new user fields: `marketing_opt_in` (bool) and `privacy_accepted_at` (timestamp).
  - Migrations: added proper migration to create the new columns and constraints; applied to Neon DB.

- Models and persistence
  - `users`: unique `(oauth_provider, oauth_sub)` and `stripe_customer_id`, added `marketing_opt_in`, `privacy_accepted_at`.
  - `sessions`: cascade relationship, composite index `(user_id, created_at)`.
  - Generations already persist per-user on successful generation; dashboard displays them.

- UX and routes
  - Generation gated behind login; Generate link hidden for anonymous users; `/generate` redirects to `/login?next=/generate`.
  - Navbar: “Home” becomes “Dashboard” for logged-in users.
  - New dashboard page (`/me/dashboard`) shows plan, quotas left, and a collapsible list of generated drafts.
  - Login and OAuth flows preserve `next` parameter to return users to their intended page post-auth.

Notes

- For local dev, ensure `.env` has `APP_BASE_URL=http://localhost:5000` and LinkedIn OIDC credentials.
- EasyOCR requires numpy/torch/opencv; installed into `.venv`.
- If Vision is preferred, set `PDF_EXTRACTOR=vision`.


