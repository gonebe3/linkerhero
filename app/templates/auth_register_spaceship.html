{% extends 'base_spaceship.html' %}
{% block content %}
<div class="container pt-6rem">
  <div class="section maxw-520 mx-auto">
    <div class="text-center mb-6">
      <h1 class="fw-800 mb-1rem c-white fs-22rem">Create your account</h1>
      <p class="fs-11rem c-white-80">Start with the Free plan. Upgrade anytime.</p>
    </div>

    <div class="card">
      <form method="post" action="/register" autocomplete="off">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

        {% if error %}
        <div class="error mb-1 text-center">{{ error }}</div>
        {% endif %}
        {% if already_registered %}
        <div class="card p-05 bg-soft border-soft c-white mb-1 text-center">
          <div class="mb-05">This email is already registered. Would you like to log in?</div>
          <a class="btn btn-cta inline-block" href="/login">Go to Login</a>
        </div>
        {% endif %}

        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" name="email" class="form-input" placeholder="you@example.com" value="{{ prefill_email or '' }}" autocomplete="off" required />
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" name="password" class="form-input" placeholder="At least 8 chars, 1 uppercase, 1 special" autocomplete="new-password" required />
        </div>
        <div id="register-extras" class="hidden">
          <div class="form-group">
            <label class="form-label">Confirm Password</label>
            <input type="password" name="confirm_password" class="form-input" placeholder="Repeat your password" />
          </div>

          <div class="form-group mt-4">
            <label class="flex items-center gap-05 cursor-pointer c-white">
              <input type="checkbox" name="privacy_ok" class="checkbox-custom">
              <span>I agree to the <a href="/privacy" class="link-cta">Privacy Policy</a></span>
            </label>
          </div>
          <div class="form-group mt-05">
            <label class="flex items-center gap-05 cursor-pointer c-white">
              <input type="checkbox" name="marketing_opt_in" class="checkbox-custom">
              <span>I agree to receive news, updates, and promotions. <a href="/email-policy" class="link-cta">Learn more</a></span>
            </label>
          </div>
        </div>

        <script>
          const emailInput = document.querySelector('input[name=email]');
          const pwdInput = document.querySelector('input[name=password]');
          const extras = document.getElementById('register-extras');
          function showExtrasIfReady() {
            const emailReady = emailInput && emailInput.value.length > 0 && emailInput.checkValidity();
            const pwdReady = pwdInput && pwdInput.value.length > 0;
            extras.style.display = (emailReady && pwdReady) ? 'block' : 'none';
          }
          emailInput.addEventListener('input', showExtrasIfReady);
          pwdInput.addEventListener('input', showExtrasIfReady);
          document.addEventListener('DOMContentLoaded', showExtrasIfReady);
        </script>
        <div class="text-center mt-1">
          <button type="submit" class="btn btn-cta w-full p-1">Create Account</button>
        </div>
      </form>

      <div class="text-center my-3 c-white-60">or</div>
      <div class="oauth-buttons">
        <a href="/login/linkedin" class="btn btn-translucent btn-oauth" onclick="event.stopPropagation();">
          <img
            class="oauth-icon"
            src="{{ url_for('static', filename='images/providers/linkedin.png') }}"
            alt="LinkedIn"
            width="20"
            height="20"
            loading="lazy"
          />
          <span>Continue with LinkedIn</span>
        </a>
        <a href="/oauth/google/start" class="btn btn-translucent btn-oauth" onclick="event.stopPropagation();">
          <img
            class="oauth-icon"
            src="{{ url_for('static', filename='images/providers/google.svg') }}"
            alt="Google"
            width="20"
            height="20"
            loading="lazy"
          />
          <span>Continue with Google</span>
        </a>
      </div>
    </div>

    <div class="text-center mt-4">
      <p class="c-white-70 fs-09rem">
        Already have an account? <a href="/login" class="link-cta">Sign in</a>.
      </p>
    </div>
  </div>
</div>
{% endblock %}


