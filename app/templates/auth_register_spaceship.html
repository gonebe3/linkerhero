{% extends 'base_spaceship.html' %}
{% block content %}
<div class="container pt-6rem">
  <div class="section maxw-520 mx-auto">
    <div class="text-center mb-6">
      <h1 class="fw-800 mb-1rem c-white fs-22rem">Create your account</h1>
      <p class="fs-11rem c-white-80">Start with the Free plan. Upgrade anytime.</p>
    </div>

    <div class="card">
      <form method="post" action="/register" autocomplete="off">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" name="email" class="form-input" placeholder="you@example.com" autocomplete="off" required />
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" name="password" class="form-input" placeholder="At least 8 chars, 1 uppercase, 1 special" autocomplete="new-password" required />
        </div>
        <div id="register-extras" class="hidden">
          <div class="form-group">
            <label class="form-label">Confirm Password</label>
            <input type="password" name="confirm_password" class="form-input" placeholder="Repeat your password" />
          </div>

          <div class="form-group mt-4">
            <label class="flex items-center gap-05 cursor-pointer c-white">
              <input type="checkbox" name="privacy_ok" class="checkbox-custom">
              <span>I agree to the <a href="/privacy" class="link-cta">Privacy Policy</a></span>
            </label>
          </div>
          <div class="form-group mt-05">
            <label class="flex items-center gap-05 cursor-pointer c-white">
              <input type="checkbox" name="marketing_opt_in" class="checkbox-custom">
              <span>I agree to receive news, updates, and promotions. <a href="/email-policy" class="link-cta">Learn more</a></span>
            </label>
          </div>
        </div>

        <script>
          const emailInput = document.querySelector('input[name=email]');
          const pwdInput = document.querySelector('input[name=password]');
          const extras = document.getElementById('register-extras');
          let userTyped = false;
          function showExtrasIfReady() {
            const emailReady = emailInput && emailInput.value.length > 0 && emailInput.checkValidity();
            const pwdReady = pwdInput && pwdInput.value.length > 0;
            // Only reveal extras after the user actually types, to avoid Chrome autofill-on-first-click UX glitches
            extras.style.display = (userTyped && emailReady && pwdReady) ? 'block' : 'none';
          }
          const markTyped = () => { userTyped = true; };
          emailInput.addEventListener('keydown', markTyped);
          pwdInput.addEventListener('keydown', markTyped);
          emailInput.addEventListener('input', showExtrasIfReady);
          pwdInput.addEventListener('input', showExtrasIfReady);
          // draw white X when checked
          document.addEventListener('change', (e) => {
            if (e.target && e.target.matches('input[type=checkbox]')) {
              e.target.style.background = e.target.checked ? 'linear-gradient(45deg, transparent 45%, #fff 45%, #fff 55%, transparent 55%), linear-gradient(-45deg, transparent 45%, #fff 45%, #fff 55%, transparent 55%)' : '#000';
              e.target.style.backgroundSize = '100% 100%';
            }
          });
        </script>
        <div class="text-center">
          <button type="submit" class="btn btn-cta w-full p-1">Create Account</button>
        </div>
      </form>

      {% if error %}
      <div class="error mt-4">{{ error }}</div>
      {% endif %}

      <div class="text-center my-3 c-white-60">or</div>
      <div class="flex gap-05 flex-wrap justify-center">
        <a href="/login/linkedin" class="btn btn-translucent" onclick="event.stopPropagation();">Continue with LinkedIn</a>
        <a href="/oauth/google/start" class="btn btn-translucent" onclick="event.stopPropagation();">Continue with Google</a>
      </div>
    </div>

    <div class="text-center mt-4">
      <p class="c-white-70 fs-09rem">
        Already have an account? <a href="/login" class="link-cta">Sign in</a>.
      </p>
    </div>
  </div>
</div>
{% endblock %}


