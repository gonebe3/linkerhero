{% extends 'base_spaceship.html' %}
{% block content %}
<div class="container" style="padding-top: 6rem;">
  <div class="section" style="max-width: 520px; margin: 0 auto;">
    <div class="text-center mb-6">
      <h1 style="font-size: 2.2rem; font-weight: 800; margin-bottom: 1rem; color: white;">Create your account</h1>
      <p style="font-size: 1.1rem; color: rgba(255, 255, 255, 0.8);">Start with the Free plan. Upgrade anytime.</p>
    </div>

    <div class="card">
      <form method="post" action="/register" autocomplete="off">
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" name="email" class="form-input" placeholder="you@example.com" autocomplete="off" required />
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" name="password" class="form-input" placeholder="At least 8 chars, 1 uppercase, 1 special" autocomplete="new-password" required />
        </div>
        <div id="register-extras" style="display:none;">
          <div class="form-group">
            <label class="form-label">Confirm Password</label>
            <input type="password" name="confirm_password" class="form-input" placeholder="Repeat your password" />
          </div>

          <div class="form-group" style="margin-top:1rem;">
            <label style="display:flex; align-items:center; gap:0.6rem; cursor:pointer; color:#fff;">
              <input type="checkbox" name="privacy_ok" style="appearance:none; width:22px; height:22px; border:2px solid #fff; background:#000; display:inline-grid; place-content:center;">
              <span>I agree to the <a href="/privacy" style="color:#ff9913; text-decoration:none;">Privacy Policy</a></span>
            </label>
          </div>
          <div class="form-group" style="margin-top:0.5rem;">
            <label style="display:flex; align-items:center; gap:0.6rem; cursor:pointer; color:#fff;">
              <input type="checkbox" name="marketing_opt_in" style="appearance:none; width:22px; height:22px; border:2px solid #fff; background:#000; display:inline-grid; place-content:center;">
              <span>I agree to receive news, updates, and promotions. <a href="/email-policy" style="color:#ff9913; text-decoration:none;">Learn more</a></span>
            </label>
          </div>
        </div>

        <script>
          const emailInput = document.querySelector('input[name=email]');
          const pwdInput = document.querySelector('input[name=password]');
          const extras = document.getElementById('register-extras');
          let userTyped = false;
          function showExtrasIfReady() {
            const emailReady = emailInput && emailInput.value.length > 0 && emailInput.checkValidity();
            const pwdReady = pwdInput && pwdInput.value.length > 0;
            // Only reveal extras after the user actually types, to avoid Chrome autofill-on-first-click UX glitches
            extras.style.display = (userTyped && emailReady && pwdReady) ? 'block' : 'none';
          }
          const markTyped = () => { userTyped = true; };
          emailInput.addEventListener('keydown', markTyped);
          pwdInput.addEventListener('keydown', markTyped);
          emailInput.addEventListener('input', showExtrasIfReady);
          pwdInput.addEventListener('input', showExtrasIfReady);
          // draw white X when checked
          document.addEventListener('change', (e) => {
            if (e.target && e.target.matches('input[type=checkbox]')) {
              e.target.style.background = e.target.checked ? 'linear-gradient(45deg, transparent 45%, #fff 45%, #fff 55%, transparent 55%), linear-gradient(-45deg, transparent 45%, #fff 45%, #fff 55%, transparent 55%)' : '#000';
              e.target.style.backgroundSize = '100% 100%';
            }
          });
        </script>
        <div class="text-center">
          <button type="submit" class="btn btn-cta" style="width:100%; padding:1rem;">Create Account</button>
        </div>
      </form>

      {% if error %}
      <div class="error mt-4">{{ error }}</div>
      {% endif %}

      <div class="text-center" style="margin: 1rem 0; color: rgba(255,255,255,.6);">or</div>
      <div style="display:flex; gap:0.5rem; flex-wrap:wrap; justify-content:center;">
        <a href="/login/linkedin" class="btn" style="background:rgba(255,255,255,.15);" onclick="event.stopPropagation();">Continue with LinkedIn</a>
        <a href="/oauth/google/start" class="btn" style="background:rgba(255,255,255,.15);" onclick="event.stopPropagation();">Continue with Google</a>
      </div>
    </div>

    <div class="text-center mt-4">
      <p style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">
        Already have an account? <a href="/login" style="color:#ff9913; text-decoration:none;">Sign in</a>.
      </p>
    </div>
  </div>
</div>
{% endblock %}


