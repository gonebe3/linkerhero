{% extends 'base_spaceship.html' %}
{% block content %}
<div class="container" style="padding-top: 6rem;">
  <div class="section">
    <div class="text-center mb-6">
      <h1 style="font-size: 2.5rem; font-weight: 800; margin-bottom: 1rem; color: white;">Generate LinkedIn Drafts</h1>
      <p style="font-size: 1.2rem; color: rgba(255, 255, 255, 0.8);">Turn a URL or your text into 3 LinkedIn-style drafts.</p>
    </div>

    <div class="card">
      <form id="gen-form" hx-post="/api/generate" hx-target="#results" hx-swap="innerHTML" hx-indicator="#loading" autocomplete="off">
        <div class="form-group">
          <label class="form-label">üîó Article URL</label>
          <input type="url" name="url" value="{{ prefill_url or form.url.data or '' }}" class="form-input" placeholder="https://example.com/article" />
          <p style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.6); margin-top: 0.5rem;">Enter a URL, or leave empty to paste your own text below.</p>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">üë§ Your Persona</label>
            <div class="custom-select" data-select-name="persona">
              <button type="button" class="custom-select__button" data-value="{{ form.persona.data or 'PM' }}">{{ {'PM':'Product Manager','Consultant':'Consultant','Engineer':'Engineer','Founder':'Founder','Marketer':'Marketer','Sales':'Sales'}[form.persona.data or 'PM'] }}</button>
              <div class="custom-select__menu">
                <div class="custom-select__option" data-value="PM">Product Manager</div>
                <div class="custom-select__option" data-value="Consultant">Consultant</div>
                <div class="custom-select__option" data-value="Engineer">Engineer</div>
                <div class="custom-select__option" data-value="Founder">Founder</div>
                <div class="custom-select__option" data-value="Marketer">Marketer</div>
                <div class="custom-select__option" data-value="Sales">Sales</div>
              </div>
              <input type="hidden" name="persona" value="{{ form.persona.data or 'PM' }}" />
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">üé≠ Tone of Voice</label>
            <div class="custom-select" data-select-name="tone">
              <button type="button" class="custom-select__button" data-value="{{ form.tone.data or 'analytical' }}">{{ {'analytical':'Analytical','bold':'Bold','conversational':'Conversational','storytelling':'Storytelling','data-driven':'Data-driven'}[form.tone.data or 'analytical'] }}</button>
              <div class="custom-select__menu">
                <div class="custom-select__option" data-value="analytical">Analytical</div>
                <div class="custom-select__option" data-value="bold">Bold</div>
                <div class="custom-select__option" data-value="conversational">Conversational</div>
                <div class="custom-select__option" data-value="storytelling">Storytelling</div>
                <div class="custom-select__option" data-value="data-driven">Data-driven</div>
              </div>
              <input type="hidden" name="tone" value="{{ form.tone.data or 'analytical' }}" />
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">üß≤ Hook Type
              <span title="The opening style of the post; choose the kind of hook you want (e.g., question or contrarian)." style="cursor: help; color: rgba(255,255,255,0.8);">‚ÑπÔ∏è</span>
            </label>
            <div class="custom-select" data-select-name="hook_type">
              <button type="button" class="custom-select__button" data-value="{{ form.hook_type.data or 'auto' }}">{{ {'auto':'Auto','question':'Question','contrarian':'Contrarian','numbered':'Numbered','how_to':'How-to','story':'Short Story'}[form.hook_type.data or 'auto'] }}</button>
              <div class="custom-select__menu">
                <div class="custom-select__option" data-value="auto">Auto</div>
                <div class="custom-select__option" data-value="question">Question</div>
                <div class="custom-select__option" data-value="contrarian">Contrarian</div>
                <div class="custom-select__option" data-value="numbered">Numbered</div>
                <div class="custom-select__option" data-value="how_to">How-to</div>
                <div class="custom-select__option" data-value="story">Short Story</div>
              </div>
              <input type="hidden" name="hook_type" value="{{ form.hook_type.data or 'auto' }}" />
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">üß† Model</label>
            <div class="custom-select" data-select-name="model">
              <button type="button" class="custom-select__button" data-value="{{ form.model.data or 'claude' }}">{{ {'claude':'Claude 3.5 Sonnet','gpt-5':'ChatGPT 5'}[form.model.data or 'claude'] }}</button>
              <div class="custom-select__menu">
                <div class="custom-select__option" data-value="claude">Claude 3.5 Sonnet</div>
                <div class="custom-select__option" data-value="gpt-5">ChatGPT 5</div>
              </div>
              <input type="hidden" name="model" value="{{ form.model.data or 'claude' }}" />
            </div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">‚úçÔ∏è Or Write/Paste Your Own Text</label>
          <textarea name="text" rows="6" class="form-textarea" placeholder="Paste or write your source content here... (optional)">{{ form.text.data or '' }}</textarea>
          <p style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.6); margin-top: 0.5rem;">Provide either a URL or your text (not both).</p>
        </div>

        <div class="text-center mt-4">
          <button type="submit" class="btn btn-cta" style="font-size: 1.2rem; padding: 1.2rem 3rem;">
            ‚ú® Generate Posts
          </button>
        </div>
      </form>
      <script>
        (function() {
          const form = document.getElementById('gen-form');
          const urlInput = form.querySelector('input[name="url"]');
          const textArea = form.querySelector('textarea[name="text"]');
          function enforceExclusive() {
            if (urlInput.value.trim()) {
              textArea.disabled = true;
              textArea.placeholder = 'Disabled because URL is provided';
            } else {
              textArea.disabled = false;
              textArea.placeholder = 'Paste or write your source content here... (optional)';
            }
            if (textArea.value.trim()) {
              urlInput.disabled = true;
              urlInput.placeholder = 'Disabled because text is provided';
            } else {
              urlInput.disabled = false;
              urlInput.placeholder = 'https://example.com/article';
            }
          }
          urlInput.addEventListener('input', enforceExclusive);
          textArea.addEventListener('input', enforceExclusive);
          enforceExclusive();

          document.querySelectorAll('.custom-select').forEach(function(wrapper){
            const button = wrapper.querySelector('.custom-select__button');
            const menu = wrapper.querySelector('.custom-select__menu');
            const hidden = wrapper.querySelector('input[type="hidden"]');
            function closeAll(ev){ if (!wrapper.contains(ev.target)) menu.classList.remove('open'); }
            button.addEventListener('click', function(){ menu.classList.toggle('open'); });
            menu.querySelectorAll('.custom-select__option').forEach(function(opt){
              opt.addEventListener('click', function(){
                const val = this.getAttribute('data-value');
                const label = this.textContent.trim();
                hidden.value = val; button.textContent = label; button.setAttribute('data-value', val); menu.classList.remove('open');
              });
            });
            document.addEventListener('click', closeAll);
          });
        })();
      </script>
    </div>
  </div>

  <div id="loading" class="htmx-indicator" style="text-align: center; margin: 2rem 0;">
    <div class="card">
      <div class="spinner" style="margin: 2rem auto;"></div>
      <p style="color: white; font-size: 1.1rem;">üöÄ AI is crafting your posts...</p>
    </div>
  </div>

  <div id="results"></div>
</div>
{% endblock %}


